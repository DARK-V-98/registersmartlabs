
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "Display name of the user."
        },
        "phoneNumber": {
          "type": "string",
          "description": "The user's phone number, preferably WhatsApp."
        },
        "role": {
          "type": "string",
          "description": "Role of the user (e.g., 'user', 'admin', 'developer', 'superadmin'). Default is 'user'.",
          "enum": ["student", "admin", "developer", "superadmin"]
        }
      },
      "required": [
        "id",
        "email",
        "displayName",
        "role"
      ]
    },
    "Course": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course",
      "type": "object",
      "description": "Represents a course offered.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the course."
        },
        "name": {
          "type": "string",
          "description": "Name of the course."
        },
        "description": {
          "type": "string",
          "description": "Description of the course."
        },
        "priceOnlineAddHour": {
            "type": "number",
            "description": "Price for an additional hour for an online class."
        },
        "pricePhysicalAddHour": {
            "type": "number",
            "description": "Price for an additional hour for a physical class."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "Lecturer": {
        "title": "Lecturer",
        "type": "object",
        "description": "Represents a lecturer who teaches courses.",
        "properties": {
            "id": { "type": "string" },
            "name": { "type": "string" },
            "courses": { "type": "array", "items": { "type": "string" } },
            "averageRating": { "type": "number" },
            "reviewCount": { "type": "number" },
            "payoutRate": { "type": "number", "description": "Percentage of revenue to be paid out to the lecturer." }
        }
    },
    "Booking": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Booking",
      "type": "object",
      "description": "Represents a user's booking for a course.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the booking."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User."
        },
        "userPhoneNumber": {
          "type": "string",
          "description": "The phone number of the user who made the booking."
        },
        "courseId": {
          "type": "string"
        },
        "courseName": {
          "type": "string"
        },
        "courseIcon": {
          "type": "string"
        },
        "date": {
          "type": "string",
          "format": "date-time"
        },
        "time": {
          "type": "string"
        },
        "duration": {
            "type": "number",
            "description": "Duration of the class in hours (1 or 2)."
        },
        "classType": {
          "type": "string",
          "enum": ["online", "physical"]
        },
        "status": {
          "type": "string",
          "enum": ["pending", "confirmed", "rejected", "cancelled", "completed"]
        },
        "enrollmentDate": {
          "type": "string",
          "format": "date-time"
        },
        "isReviewed": {
            "type": "boolean",
            "description": "Indicates if the student has left a review for this booking."
        }
      },
      "required": [
        "userId",
        "courseId",
        "courseName",
        "date",
        "time",
        "duration",
        "classType",
        "status",
        "enrollmentDate"
      ]
    },
    "AdminSettings": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AdminSettings",
      "type": "object",
      "description": "Stores global settings configurable by an admin.",
      "properties": {
        "bankDetails": {
          "type": "string",
          "description": "Bank account details for payments."
        },
        "whatsappNumber": {
          "type": "string",
          "description": "WhatsApp number for payment verification."
        },
        "whatsappContactUrl": {
            "type": "string",
            "description": "Full WhatsApp chat link for student contact."
        },
        "disabledDates": {
          "type": "array",
          "description": "An array of dates (YYYY-MM-DD) that are unavailable for booking.",
          "items": {
            "type": "string",
            "format": "date"
          }
        }
      }
    },
    "Schedule": {
      "title": "Schedule",
      "type": "object",
      "description": "Represents the booked time slots for a specific day.",
      "properties": {
        "bookedSlots": {
          "type": "array",
          "description": "An array of time slots that are booked for this day.",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "Message": {
      "title": "Message",
      "type": "object",
      "description": "Represents a chat message within a booking.",
      "properties": {
        "text": {
          "type": "string",
          "description": "The content of the message."
        },
        "senderId": {
          "type": "string",
          "description": "The UID of the user who sent the message."
        },
        "senderName": {
          "type": "string",
          "description": "The display name of the sender."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the message was sent."
        }
      },
      "required": ["text", "senderId", "senderName", "createdAt"]
    },
    "Review": {
        "title": "Review",
        "type": "object",
        "description": "A student review for a lecturer.",
        "properties": {
            "studentId": { "type": "string" },
            "studentName": { "type": "string" },
            "rating": { "type": "number", "minimum": 1, "maximum": 5 },
            "comment": { "type": "string" },
            "createdAt": { "type": "string", "format": "date-time" }
        },
        "required": ["studentId", "studentName", "rating", "createdAt"]
    },
    "ActivityLog": {
      "title": "Activity Log",
      "type": "object",
      "description": "Records administrative actions performed in the system for audit purposes.",
      "properties": {
        "actorId": { "type": "string", "description": "The UID of the user who performed the action." },
        "actorName": { "type": "string", "description": "The name of the user who performed the action." },
        "action": { "type": "string", "description": "A dot-notation string representing the action (e.g., 'booking.confirm')." },
        "entityType": { "type": "string", "description": "The type of entity affected (e.g., 'booking', 'user')." },
        "entityId": { "type": "string", "description": "The ID of the document or entity that was affected." },
        "timestamp": { "type": "string", "format": "date-time", "description": "When the action occurred." },
        "details": { "type": "object", "description": "An object containing relevant data about the action." },
        "targetUserId": { "type": "string", "description": "Optional UID of the user who was the subject of the action." },
        "targetUserName": { "type": "string", "description": "Optional name of the subject user." }
      },
      "required": ["actorId", "actorName", "action", "entityType", "entityId", "timestamp"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile data, including their role for access control.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}",
        "definition": {
          "entityName": "Course",
          "schema": {
            "$ref": "#/backend/entities/Course"
          },
          "description": "Stores course information. Publicly readable.",
          "params": [
            {
              "name": "courseId",
              "description": "Unique identifier for the course."
            }
          ]
        }
      },
      {
        "path": "/lecturers/{lecturerId}",
        "definition": {
            "entityName": "Lecturer",
            "schema": { "$ref": "#/backend/entities/Lecturer" },
            "description": "Stores information about lecturers, including their ratings."
        }
      },
      {
        "path": "/lecturers/{lecturerId}/reviews/{reviewId}",
        "definition": {
            "entityName": "Review",
            "schema": { "$ref": "#/backend/entities/Review" },
            "description": "Subcollection for storing all reviews for a specific lecturer."
        }
      },
      {
        "path": "/bookings/{bookingId}",
        "definition": {
          "entityName": "Booking",
          "schema": {
            "$ref": "#/backend/entities/Booking"
          },
          "description": "A centralized collection for all user bookings. Admins can manage all bookings, while users can only access their own.",
          "params": [
            {
              "name": "bookingId",
              "description": "Unique identifier for the booking."
            }
          ]
        }
      },
      {
        "path": "/bookings/{bookingId}/messages/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": {
            "$ref": "#/backend/entities/Message"
          },
          "description": "A subcollection for chat messages related to a specific booking. Accessible by the user and admins.",
          "params": [
            {
              "name": "bookingId",
              "description": "Unique identifier for the booking."
            },
            {
              "name": "messageId",
              "description": "Unique identifier for the message."
            }
          ]
        }
      },
      {
        "path": "/settings/admin",
        "definition": {
          "entityName": "AdminSettings",
          "schema": {
            "$ref": "#/backend/entities/AdminSettings"
          },
          "description": "A single document to store global configurations like payment info and disabled dates. Readable by users, writable only by admins.",
          "params": []
        }
      },
      {
        "path": "/schedules/{date}",
        "definition": {
          "entityName": "Schedule",
          "schema": {
            "$ref": "#/backend/entities/Schedule"
          },
          "description": "Stores aggregated booking information for each day to show availability. Readable by users, writable only by admins.",
          "params": [
            {
              "name": "date",
              "description": "The date in YYYY-MM-DD format."
            }
          ]
        }
      },
      {
        "path": "/activityLogs/{logId}",
        "definition": {
          "entityName": "ActivityLog",
          "schema": { "$ref": "#/backend/entities/ActivityLog" },
          "description": "Stores a log of all administrative actions for auditing. Writable by admins, readable only by developers/superadmins."
        }
      }
    ],
    "reasoning": "The data structure is revised for administrative functionality. User-specific data remains in `/users/{userId}`. A top-level `/bookings` collection is introduced to allow admins to easily query and manage all enrollments, which is more efficient than nested subcollections. A `messages` subcollection has been added to each booking to support real-time chat. Security rules will grant admins broad access to `/bookings`, while users are restricted to their own documents. A single document at `/settings/admin` stores global configurations like payment details and disabled dates, making them easily accessible to the client-side while restricting write access to admins. A new `/schedules` collection will denormalize booking times to allow users to see availability without exposing other users' private data. Lecturers have been moved to a top-level collection with a `reviews` subcollection to handle ratings and reviews. An `activityLogs` collection has been added to audit all administrative actions."
  }
}
